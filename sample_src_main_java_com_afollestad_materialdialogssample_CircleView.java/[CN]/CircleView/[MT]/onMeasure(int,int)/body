{
  int widthMode=MeasureSpec.getMode(widthMeasureSpec);
  int heightMode=MeasureSpec.getMode(heightMeasureSpec);
  if (widthMode == MeasureSpec.EXACTLY && heightMode != MeasureSpec.EXACTLY) {
    int width=MeasureSpec.getSize(widthMeasureSpec);
    int height=width;
    if (heightMode == MeasureSpec.AT_MOST)     height=Math.min(height,MeasureSpec.getSize(heightMeasureSpec));
    setMeasuredDimension(width,height);
  }
 else {
    super.onMeasure(widthMeasureSpec,heightMeasureSpec);
  }
}
