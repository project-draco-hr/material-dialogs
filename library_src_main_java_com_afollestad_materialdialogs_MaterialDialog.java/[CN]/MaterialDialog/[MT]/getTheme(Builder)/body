{
  TypedArray a=builder.context.getTheme().obtainStyledAttributes(new int[]{R.attr.md_dark_theme});
  boolean darkTheme=builder.theme == Theme.DARK;
  if (!darkTheme) {
    try {
      darkTheme=a.getBoolean(0,false);
      builder.theme=darkTheme ? Theme.DARK : Theme.LIGHT;
    }
  finally {
      a.recycle();
    }
  }
  return new ContextThemeWrapper(builder.context,darkTheme ? R.style.MD_Dark : R.style.MD_Light);
}
